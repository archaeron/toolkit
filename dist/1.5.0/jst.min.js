/*!
    Copyright (c) 2009, 280 North Inc. http://280north.com/
    MIT License. http://github.com/280north/narwhal/blob/master/README.md
*/
(function(definition){if(typeof define=="function"){define(function(){definition()})}else{definition()}})(function(undefined){if(!Function.prototype.bind){Function.prototype.bind=function bind(that){var target=this;if(typeof target.apply!="function"||typeof target.call!="function"){return new TypeError()}var args=slice.call(arguments,1);var bound=function(){if(this instanceof bound){var F=function(){};F.prototype=target.prototype;var self=new F;var result=target.apply(self,args.concat(slice.call(arguments)));if(result!==null&&Object(result)===result){return result}return self}else{return target.apply(that,args.concat(slice.call(arguments)))}};return bound}}var call=Function.prototype.call;var prototypeOfArray=Array.prototype;var prototypeOfObject=Object.prototype;var slice=prototypeOfArray.slice;var toString=prototypeOfObject.toString;var owns=call.bind(prototypeOfObject.hasOwnProperty);var defineGetter,defineSetter,lookupGetter,lookupSetter,supportsAccessors;if((supportsAccessors=owns(prototypeOfObject,"__defineGetter__"))){defineGetter=call.bind(prototypeOfObject.__defineGetter__);defineSetter=call.bind(prototypeOfObject.__defineSetter__);lookupGetter=call.bind(prototypeOfObject.__lookupGetter__);lookupSetter=call.bind(prototypeOfObject.__lookupSetter__)}if(!Array.isArray){Array.isArray=function isArray(obj){return toString.call(obj)=="[object Array]"}}if(!prototypeOfArray.forEach){prototypeOfArray.forEach=function forEach(fun){var self=Object(this),thisp=arguments[1],i=0,length=self.length>>>0;if(!fun||!fun.call){throw new TypeError()}while(i<length){if(i in self){fun.call(thisp,self[i],i,self)}i++}}}if(!prototypeOfArray.map){prototypeOfArray.map=function map(fun){var self=Object(this);var length=self.length>>>0;if(typeof fun!="function"){throw new TypeError()}var result=new Array(length);var thisp=arguments[1];for(var i=0;i<length;i++){if(i in self){result[i]=fun.call(thisp,self[i],i,self)}}return result}}if(!prototypeOfArray.filter){prototypeOfArray.filter=function filter(fun){var self=Object(this);var length=self.length>>>0;if(typeof fun!="function"){throw new TypeError()}var result=[];var thisp=arguments[1];for(var i=0;i<length;i++){if(i in self&&fun.call(thisp,self[i],i,self)){result.push(self[i])}}return result}}if(!prototypeOfArray.every){prototypeOfArray.every=function every(fun){if(this===void 0||this===null){throw new TypeError()}if(typeof fun!=="function"){throw new TypeError()}var self=Object(this);var length=self.length>>>0;var thisp=arguments[1];for(var i=0;i<length;i++){if(i in self&&!fun.call(thisp,self[i],i,self)){return false}}return true}}if(!prototypeOfArray.some){prototypeOfArray.some=function some(fun){if(this===void 0||this===null){throw new TypeError()}if(typeof fun!=="function"){throw new TypeError()}var self=Object(this);var length=self.length>>>0;var thisp=arguments[1];for(var i=0;i<length;i++){if(i in self&&fun.call(thisp,self[i],i,self)){return true}}return false}}if(!prototypeOfArray.reduce){prototypeOfArray.reduce=function reduce(fun){var self=Object(this);var length=self.length>>>0;if(toString.call(fun)!="[object Function]"){throw new TypeError()}if(!length&&arguments.length==1){throw new TypeError()}var i=0;var result;if(arguments.length>=2){result=arguments[1]}else{do{if(i in self){result=self[i++];break}if(++i>=length){throw new TypeError()}}while(true)}for(;i<length;i++){if(i in self){result=fun.call(null,result,self[i],i,self)}}return result}}if(!prototypeOfArray.reduceRight){prototypeOfArray.reduceRight=function reduceRight(fun){var self=Object(this);var length=self.length>>>0;if(toString.call(fun)!="[object Function]"){throw new TypeError()}if(!length&&arguments.length==1){throw new TypeError()}var result,i=length-1;if(arguments.length>=2){result=arguments[1]}else{do{if(i in self){result=self[i--];break}if(--i<0){throw new TypeError()}}while(true)}do{if(i in this){result=fun.call(null,result,self[i],i,self)}}while(i--);return result}}if(!prototypeOfArray.indexOf){prototypeOfArray.indexOf=function indexOf(sought){if(this===void 0||this===null){throw new TypeError()}var self=Object(this);var length=self.length>>>0;if(!length){return -1}var i=0;if(arguments.length>1){i=toInteger(arguments[1])}i=i>=0?i:length-Math.abs(i);for(;i<length;i++){if(i in self&&self[i]===sought){return i}}return -1}}if(!prototypeOfArray.lastIndexOf){prototypeOfArray.lastIndexOf=function lastIndexOf(sought){if(this===void 0||this===null){throw new TypeError()}var self=Object(this);var length=self.length>>>0;if(!length){return -1}var i=length-1;if(arguments.length>1){i=toInteger(arguments[1])}i=i>=0?i:length-Math.abs(i);for(;i>=0;i--){if(i in self&&sought===self[i]){return i}}return -1}}if(!Object.getPrototypeOf){Object.getPrototypeOf=function getPrototypeOf(object){return object.__proto__||object.constructor.prototype}}if(!Object.getOwnPropertyDescriptor){var ERR_NON_OBJECT="Object.getOwnPropertyDescriptor called on a non-object: ";Object.getOwnPropertyDescriptor=function getOwnPropertyDescriptor(object,property){if((typeof object!="object"&&typeof object!="function")||object===null){throw new TypeError(ERR_NON_OBJECT+object)}if(!owns(object,property)){return undefined}var descriptor,getter,setter;descriptor={enumerable:true,configurable:true};if(supportsAccessors){var prototype=object.__proto__;object.__proto__=prototypeOfObject;var getter=lookupGetter(object,property);var setter=lookupSetter(object,property);object.__proto__=prototype;if(getter||setter){if(getter){descriptor.get=getter}if(setter){descriptor.set=setter}return descriptor}}descriptor.value=object[property];return descriptor}}if(!Object.getOwnPropertyNames){Object.getOwnPropertyNames=function getOwnPropertyNames(object){return Object.keys(object)}}if(!Object.create){Object.create=function create(prototype,properties){var object;if(prototype===null){object={__proto__:null}}else{if(typeof prototype!="object"){throw new TypeError("typeof prototype["+(typeof prototype)+"] != 'object'")}var Type=function(){};Type.prototype=prototype;object=new Type();object.__proto__=prototype}if(typeof properties!="undefined"){Object.defineProperties(object,properties)}return object}}var oldDefineProperty=Object.defineProperty;var defineProperty=!!oldDefineProperty;if(defineProperty){var subject={};Object.defineProperty(subject,"",{});defineProperty="" in subject}if(!defineProperty){var ERR_NON_OBJECT_DESCRIPTOR="Property description must be an object: ";var ERR_NON_OBJECT_TARGET="Object.defineProperty called on non-object: ";var ERR_ACCESSORS_NOT_SUPPORTED="getters & setters can not be defined on this javascript engine";Object.defineProperty=function defineProperty(object,property,descriptor){if(typeof object!="object"&&typeof object!="function"){throw new TypeError(ERR_NON_OBJECT_TARGET+object)}if(typeof descriptor!="object"||descriptor===null){throw new TypeError(ERR_NON_OBJECT_DESCRIPTOR+descriptor)}if(oldDefineProperty&&object.nodeType){return oldDefineProperty(object,property,descriptor)}if(owns(descriptor,"value")){if(supportsAccessors&&(lookupGetter(object,property)||lookupSetter(object,property))){var prototype=object.__proto__;object.__proto__=prototypeOfObject;delete object[property];object[property]=descriptor.value;object.__proto__=prototype}else{object[property]=descriptor.value}}else{if(!supportsAccessors){throw new TypeError(ERR_ACCESSORS_NOT_SUPPORTED)}if(owns(descriptor,"get")){defineGetter(object,property,descriptor.get)}if(owns(descriptor,"set")){defineSetter(object,property,descriptor.set)}}return object}}if(!Object.defineProperties){Object.defineProperties=function defineProperties(object,properties){for(var property in properties){if(owns(properties,property)){Object.defineProperty(object,property,properties[property])}}return object}}if(!Object.seal){Object.seal=function seal(object){return object}}if(!Object.freeze){Object.freeze=function freeze(object){return object}}try{Object.freeze(function(){})}catch(exception){Object.freeze=(function freeze(freezeObject){return function freeze(object){if(typeof object=="function"){return object}else{return freezeObject(object)}}})(Object.freeze)}if(!Object.preventExtensions){Object.preventExtensions=function preventExtensions(object){return object}}if(!Object.isSealed){Object.isSealed=function isSealed(object){return false}}if(!Object.isFrozen){Object.isFrozen=function isFrozen(object){return false}}if(!Object.isExtensible){Object.isExtensible=function isExtensible(object){return true}}if(!Object.keys){var hasDontEnumBug=true,dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;for(var key in {toString:null}){hasDontEnumBug=false}Object.keys=function keys(object){if(typeof object!="object"&&typeof object!="function"||object===null){throw new TypeError("Object.keys called on a non-object")}var keys=[];for(var name in object){if(owns(object,name)){keys.push(name)}}if(hasDontEnumBug){for(var i=0,ii=dontEnumsLength;i<ii;i++){var dontEnum=dontEnums[i];if(owns(object,dontEnum)){keys.push(dontEnum)}}}return keys}}if(!Date.prototype.toISOString){Date.prototype.toISOString=function toISOString(){var result,length,value;if(!isFinite(this)){throw new RangeError}result=[this.getUTCFullYear(),this.getUTCMonth()+1,this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds()];length=result.length;while(length--){value=result[length];if(value<10){result[length]="0"+value}}return result.slice(0,3).join("-")+"T"+result.slice(3).join(":")+"."+("000"+this.getUTCMilliseconds()).slice(-3)+"Z"}}if(!Date.now){Date.now=function now(){return new Date().getTime()}}if(!Date.prototype.toJSON){Date.prototype.toJSON=function toJSON(key){if(typeof this.toISOString.call!="function"){throw new TypeError()}return this.toISOString.call(this)}}if(isNaN(Date.parse("2011-06-15T21:40:05+06:00"))){Date=(function(NativeDate){var Date=function(Y,M,D,h,m,s,ms){var length=arguments.length;if(this instanceof NativeDate){var date=length==1&&String(Y)===Y?new NativeDate(Date.parse(Y)):length>=7?new NativeDate(Y,M,D,h,m,s,ms):length>=6?new NativeDate(Y,M,D,h,m,s):length>=5?new NativeDate(Y,M,D,h,m):length>=4?new NativeDate(Y,M,D,h):length>=3?new NativeDate(Y,M,D):length>=2?new NativeDate(Y,M):length>=1?new NativeDate(Y):new NativeDate();date.constructor=Date;return date}return NativeDate.apply(this,arguments)};var isoDateExpression=new RegExp("^(\\d{4})(?:-(\\d{2})(?:-(\\d{2})(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:\\.(\\d{3}))?)?(?:Z|(?:([-+])(\\d{2}):(\\d{2})))?)?)?)?$");for(var key in NativeDate){Date[key]=NativeDate[key]}Date.now=NativeDate.now;Date.UTC=NativeDate.UTC;Date.prototype=NativeDate.prototype;Date.prototype.constructor=Date;Date.parse=function parse(string){var match=isoDateExpression.exec(string);if(match){match.shift();for(var i=1;i<7;i++){match[i]=+(match[i]||(i<3?1:0));if(i==1){match[i]--}}var minutesOffset=+match.pop(),hourOffset=+match.pop(),sign=match.pop();var offset=0;if(sign){if(hourOffset>23||minuteOffset>59){return NaN}offset=(hourOffset*60+minuteOffset)*60000*(sign=="+"?-1:1)}return NativeDate.UTC.apply(this,match)+offset}return NativeDate.parse.apply(this,arguments)};return Date})(Date)}var ws="\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF";if(!String.prototype.trim||ws.trim()){ws="["+ws+"]";var trimBeginRegexp=new RegExp("^"+ws+ws+"*"),trimEndRegexp=new RegExp(ws+ws+"*$");String.prototype.trim=function trim(){return String(this).replace(trimBeginRegexp,"").replace(trimEndRegexp,"")}}var toInteger=function(n){n=+n;if(n!==n){n=-1}else{if(n!==0&&n!==(1/0)&&n!==-(1/0)){n=(n>0||-1)*Math.floor(Math.abs(n))}}return n}});Object.defineProperties(Array,{intersect:{value:function intersect(arrays){return arrays.first().filter(function(val){return arrays.every(function(arg){return arg.contains(val)})})},writable:true,enumerable:false,configurable:true},diff:{value:function diff(arrays){var vals=arrays.flatten(1);return vals.filter(function(a){return vals.indexOf(a)==vals.lastIndexOf(a)})},writable:true,enumerable:false,configurable:true},union:{value:function union(arrays){return Array.prototype.concat.apply([],arrays).unique()},writable:true,enumerable:false,configurable:true},range:{value:function range(start,stop,step){if(stop===undefined){stop=start;start=1}var arr=[];for(var i=start;i<=stop;i+=(step||1)){arr.push(i)}return arr},writable:true,enumerable:false,configurable:true}});Object.defineProperties(Array.prototype,{swap:{value:function swap(index1,index2){var value=this[index1];this[index1]=this[index2];this[index2]=value;return this},writable:true,enumerable:false,configurable:true},contains:{value:function contains(values){args=Array.prototype.slice.call(arguments);return args.every(function(arg){return !!~this.indexOf(arg)}.bind(this))},writable:true,enumerable:false,configurable:true},remove:{value:function remove(){args=Array.prototype.slice.call(arguments);args.forEach(function(arg){if(this.contains(arg)){this.splice(this.indexOf(arg),1)}}.bind(this));return this},writable:true,enumerable:false,configurable:true},shuffle:{value:function shuffle(){var arr=this.clone();for(var index=0;index<arr.length-1;index++){arr.swap(index,Number.random(index,arr.length-1).round())}return arr},writable:true,enumerable:false,configurable:true},shuffle$:{value:function shuffle$(){for(var index=0;index<this.length-1;index++){this.swap(index,Number.random(index,this.length-1).round())}return this},writable:true,enumerable:false,configurable:true},clone:{value:function clone(){return this.slice()},writable:true,enumerable:false,configurable:true},intersect:{value:function intersect(){return Array.intersect(Array.prototype.slice.call(arguments).concat([this]))},writable:true,enumerable:false,configurable:true},diff:{value:function diff(){return Array.diff(Array.prototype.slice.call(arguments).concat([this]))},writable:true,enumerable:false,configurable:true},union:{value:function union(){return Array.union(Array.prototype.slice.call(arguments).concat([this]))},writable:true,enumerable:false,configurable:true},chunk:{value:function chunk(size){for(var arr=[];this.length>0;arr.push(this.splice(0,size))){}return arr},writable:true,enumerable:false,configurable:true},chunk$:{value:function chunk$(size){for(var i=0,length=this.length/size;i<length;i++){this.splice(i,0,this.splice(i,size))}return this},writable:true,enumerable:false,configurable:true},unique:{value:function unique(){return this.filter(function(a,idx){return this.indexOf(a)==idx}.bind(this))},writable:true,enumerable:false,configurable:true},each:{value:function each(callback){var idx,result;for(idx in this){if((result=callback.call(null,this[idx],idx,this))!==undefined){return result}}},writable:true,enumerable:false,configurable:true},flatten:{value:function flatten(level){if(level===undefined){level=-1}else{if(level==0){return this.clone()}}return this.reduce(function(a,b){return a.concat((Array.isArray(b)&&level!=0)?b.flatten(level-1):[b])},[])},writable:true,enumerable:false,configurable:true},flatten$:{value:function flatten$(level){if(level===undefined){level=-1}for(var i=0,length=this.length;i<length;i++){if(Array.isArray(this[i])&&level!=0){this.splice.apply(this,[i,1].concat(this[i].flatten(level-1)))}}return this},writable:true,enumerable:false,configurable:true},sum:{value:function sum(){return this.reduce(function(a,b){return Number(a)+Number(b)})},writable:true,enumerable:false,configurable:true},product:{value:function product(){return this.reduce(function(a,b){return Number(a)*Number(b)})},writable:true,enumerable:false,configurable:true},first:{value:function first(num){return num?this.slice(0,num||1):this[0]},writable:true,enumerable:false,configurable:true},last:{value:function last(num){return num?this.slice(this.length-(num||1)):this[this.length-1]},writable:true,enumerable:false,configurable:true},clean:{value:function clean(){return this.filter(function(val){return !!val})},writable:true,enumerable:false,configurable:true},clean$:{value:function clean$(){return this.filter$(function(val){return !!val})},writable:true,enumerable:false,configurable:true},filter$:{value:function filter$(callback,scope){for(var i=0;i<this.length;i++){if(!callback.call(scope,this[i],i,this)){this.splice(i,1)&&i--}}return this},writable:true,enumerable:false,configurable:true},map$:{value:function map$(callback,scope){for(var i=0;i<this.length;i++){this[i]=callback.call(scope,this[i],i,this)}return this},writable:true,enumerable:false,configurable:true},invoke:{value:function invoke(callback){return this.map(function(val){return val[callback].apply(val,Array.prototype.slice.call(this,1))},arguments)},writable:true,enumerable:false,configurable:true},invoke$:{value:function invoke$(callback){return this.map$(function(val){return val[callback].apply(val,Array.prototype.slice.call(this,1))},arguments)},writable:true,enumerable:false,configurable:true},pluck:{value:function pluck(prop){return this.map(function(val){if(Array.isArray(prop)){return Object.filter(val,prop)}return val[prop]})},writable:true,enumerable:false,configurable:true},pluck$:{value:function pluck$(prop){return this.map$(function(val){if(Array.isArray(prop)){return Object.filter(val,prop)}return val[prop]})},writable:true,enumerable:false,configurable:true},grep:{value:function grep(regex){return this.filter(function(val){return !!val.match(regex)})},writable:true,enumerable:false,configurable:true},grep$:{value:function grep$(regex){return this.filter$(function(val){return !!val.match(regex)})},writable:true,enumerable:false,configurable:true},sort$:{value:function sort$(sort){var sorted=(typeof sort==="function")?this.sort(sort):this.sort();sorted.forEach(function(val,i){this[i]=val},this);return this},writable:true,enumerable:false,configurable:true},sortBy:{value:function sortBy(cmp,sort){if(cmp===undefined){return(typeof sort==="function")?this.sort(sort):this.sort()}if(sort===undefined){sort=function(a,b){return String(a)-String(b)}}var arr=this[typeof cmp==="function"?"map":"pluck"](cmp).map(function(val,i){return{key:i,val:val}});return arr.sort(function(a,b){return sort(a.val,b.val)}).map(function(val){return this[val.key]},this)},writable:true,enumerable:false,configurable:true},sortBy$:{value:function sortBy$(cmp,sort){this.sortBy(cmp,sort).forEach(function(v,i){this[i]=v},this);return this},writable:true,enumerable:false,configurable:true},fetch:{value:function fetch(order){if(typeof order=="function"){order=this.map(order)}if(!Array.isArray(order)){order=Array.prototype.slice.call(arguments)}var arr=[];order.forEach(function(o,i){arr[o]=this[i]},this);return arr},writable:true,enumerable:false,configurable:true}});Object.defineProperties(Function,{compose:{value:function compose(funcs){if(!Array.isArray(funcs)){funcs=Array.prototype.slice.call(arguments)}funcs=funcs.reverse();return function(arg){return funcs.reduce(function(a,b){return b(a)},arg)}},writable:true,enumerable:false,configurable:true}});Object.defineProperties(Function.prototype,{cache:{value:function cache(time,ident){time=isNaN(time)?-1:time;ident=ident||function(id){return(typeof id=="object")?Object.id(id):id.toString()};var cache={},callback=this,timeouts={};return function(){var args=Array.prototype.slice.call(arguments),id="("+args.map(ident).join(",")+")";if(!(id in cache)){cache[id]=callback.apply(callback,args)}else{if(id in timeouts){clearTimeout(timeouts[id]);delete timeouts[id]}}if(time>0){timeouts[id]=setTimeout(function(){delete cache[id]},time)}return cache[id]}},writable:true,enumerable:false,configurable:true},delay:{value:function delay(callback,time,scope){return setTimeout(function(args){callback.apply(scope,[this()].concat(Array.prototype.slice.call(args,2)))}.bind(this,arguments),time)},writable:true,enumerable:false,configurable:true},once:{value:function once(scope){var called=false,val=null;return function(args){if(!called){called=true;val=this.apply(scope,args)}return val}.bind(this,Array.prototype.slice.call(arguments))},writable:true,enumerable:false,configurable:true}});Object.defineProperties(Number,{random:{value:function random(start,end){return(start=start||0)+(((end||start+1)-start)*Math.random())},writable:true,enumerable:false,configurable:true}});Object.defineProperties(Number.prototype,{chr:{value:function(){return String.fromCharCode(this)},enumerable:false,configurable:true},odd:{value:function(){return !this.even()},enumerable:false,configurable:true},even:{value:function(){return(this%2)==0},enumerable:false,configurable:true},gcd:{value:function gcd(){return Array.prototype.slice.call(arguments).reduce(function(a,b){if(a==0||b==0){return a|b}for(var shift=0;((a|b)&1)==0;shift++){a>>=1;b>>=1}while((a&1)==0){a>>=1}do{while((b&1)==0){b>>=1}if(a<b){b-=a}else{var diff=a-b;a=b;b=diff}b>>=1}while(b!=0);return a<<shift},this)},writable:true,enumerable:false,configurable:true},lcm:{value:function lcm(){var nums=Array.prototype.slice.call(arguments),gcd=this.gcd.apply(this,nums);return Math.abs(nums.product()*this)/gcd},writable:true,enumerable:false,configurable:true},ceil:{value:function ceil(){return Math.ceil(this)},writable:true,enumerable:false,configurable:true},floor:{value:function floor(){return Math.floor(this)},writable:true,enumerable:false,configurable:true},abs:{value:function abs(){return Math.abs(this)},writable:true,enumerable:false,configurable:true},round:{value:function round(digits){digits=digits||0;if(digits==0){return Math.round(this)}else{if(digits<0){return Number(this.toPrecision(this.floor().toString().length-digits.abs()))}else{return Number(this.toFixed(digits))}}},writable:true,enumerable:false,configurable:true},radix:{value:function radix(base,size,character){return this.toString(base).pad(-size,(character||"0"))},writable:true,enumerable:false,configurable:true},bin:{value:function bin(size,character){return this.radix(2,size,character)},writable:true,enumerable:false,configurable:true},oct:{value:function oct(size,character){return this.radix(8,size,character)},writable:true,enumerable:false,configurable:true},dec:{value:function dec(size,character){return this.radix(10,size,character)},writable:true,enumerable:false,configurable:true},hexl:{value:function hexl(size,character){return this.radix(16,size,character)},writable:true,enumerable:false,configurable:true},hex:{value:function hex(size,character){return this.radix(16,size,character).toUpperCase()},writable:true,enumerable:false,configurable:true},abbr:{value:function abbr(digits,binary){binary=!!(binary==undefined?false:binary);var prefixes={k:binary?1<<10:1000,M:binary?1<<20:1000000,G:binary?1<<30:1000000000,T:binary?Math.pow(2,40):1000000000000,P:binary?Math.pow(2,50):1000000000000000,E:binary?Math.pow(2,60):1000000000000000000,Z:binary?Math.pow(2,70):1e+21,Y:binary?Math.pow(2,80):1e+24};var keys=Object.keys(prefixes),divs=Object.values(prefixes);if(divs[0]>this){return this.toFixed(digits)}for(var i=0;i<divs.length;i++){if((this/divs[i])<1){return(this/divs[i-1]).toFixed(digits)+keys[i-1]}}return(this/divs.last()).toFixed(digits)+keys.last()},writable:true,enumerable:false,configurable:true}});Object.defineProperties(Object,{id:{value:function id(obj){id.store=id.store||[];if(!id.store.contains(obj)){id.store.push(obj)}return id.store.indexOf(obj)},writable:true,enumerable:false,configurable:true},alias:{value:function alias(object,property,alias,complete){var desc=Object.getOwnPropertyDescriptor(object,property);if(!complete){Object.defineProperty(object,alias,desc)}else{if(("get" in desc)||("value" in desc)){delete desc.value,delete desc.writable;desc.get=function(){return object[property]}}desc.set=function(val){return object[property]=val};Object.defineProperty(object,alias,desc)}return object},writable:true,enumerable:false,configurable:true},values:{value:function values(obj){var arr=[];for(key in obj){arr.push(obj[key])}return arr},writable:true,enumerable:false,configurable:true},forEach:{value:function forEach(obj,callback,scope){return Object.keys(obj).forEach(function(key){return callback.call(scope,key,obj[key],obj)})},writable:true,enumerable:false,configurable:true},isObject:{value:function isObject(){return Array.prototype.slice.call(arguments).every(function(value){return typeof value==="object"&&Object(value)===value})},writable:true,enumerable:false,configurable:true},each:{value:function each(obj,callback,scope){var key,result;for(key in obj){if((result=callback.call(scope,key,obj[key],this))!==undefined){return result}}},writable:true,enumerable:false,configurable:true},map:{value:function map(object,callback,scope){var obj=Object.clone(object);Object.map$(obj,callback,scope);return obj},writable:true,enumerable:false,configurable:true},map$:{value:function map$(obj,callback,scope){Object.forEach(obj,function(key,val){obj[key]=callback.call(scope,key,val)});return obj},writable:true,enumerable:false,configurable:true},getOwnPropertyDescriptors:{value:function getOwnPropertyDescriptors(object){var descriptors={};Object.getOwnPropertyNames(object).forEach(function(key){descriptors[key]=Object.getOwnPropertyDescriptor(object,key)});return descriptors},writable:true,enumerable:false,configurable:true},reduce:{value:function reduce(obj,callback,start,scope){Object.forEach(obj,function(key,val){start=callback.call(scope,start,key,obj[key])});return start},writable:true,enumerable:false,configurable:true},merge:{value:function merge(objects,level){if(Object.isObject(objects,level)){objects=Array.prototype.slice.call(arguments),level=0}level=(level===undefined)?0:level;return objects.reduce(function(group,obj){Object.forEach(obj,function(key,val){if(!val in group||level==0||!Object.isObject(group[key])||!Object.isObject(val)){group[key]=val}else{group[key]=Object.merge([group[key],val],level-1)}});return group},{})},writable:true,enumerable:false,configurable:true},merge$:{value:function merge$(object,objects,level){if(Array.isArray(objects)){objects=[object].concat(objects)}else{objects=Array.prototype.slice.call(arguments);level=undefined}var obj=Object.merge.apply(undefined,objects,level);Object.filter$(object,function(key,val){return(key in obj)});Object.map$(object,function(key,val){return obj[key]});Object.keys(obj).diff(Object.keys(object)).forEach(function(key){object[key]=obj[key]});return object},writable:true,enumerable:false,configurable:true},clone:{value:function clone(obj,inherit){inherit=(inherit===undefined)?true:false;return Object.create(Object.getPrototypeOf(obj),inherit?Object.getOwnPropertyDescriptors(obj):undefined)},writable:true,enumerable:false,configurable:true},filter:{value:function filter(object,callback,scope){return Object.filter$(Object.clone(object),callback,scope)},writable:true,enumerable:false,configurable:true},filter$:{value:function filter$(obj,callback,scope){if(Array.isArray(callback)){var keys=callback.invoke("toString")}Object.forEach(obj,function(key,val){if(Array.isArray(callback)){if(!keys.contains(key)){delete obj[key]}}else{if(callback.call(scope,key,val,obj)===false){delete obj[key]}}});return obj},writable:true,enumerable:false,configurable:true},clean:{value:function clean(obj){return Object.filter(obj,function(key,val){return !!val})},writable:true,enumerable:false,configurable:true},clean$:{value:function clean$(obj){return Object.filter$(obj,function(key,val){return !!val})},writable:true,enumerable:false,configurable:true},size:{value:function size(obj){return Object.keys(obj).length},writable:true,enumerable:false,configurable:true},combine:{value:function combine(keys,values){var obj={};keys.forEach(function(key,i){obj[key]=values[i]});return obj},writable:true,enumerable:false,configurable:true},hash:{value:function hash(object){return Object.hash$(Object.clone(object))},writable:true,enumerable:false,configurable:true},hash$:{value:function hash$(object){return Object.defineProperties(object,{length:{get:function(){return Object.size(this)},enumerable:false,configurable:true},keys:{value:function keys(callback,scope){return Object.keys(this)},writable:true,enumerable:false,configurable:true},each:{value:function each(callback,scope){return Object.each(this,callback,scope)},writable:true,enumerable:false,configurable:true},forEach:{value:function forEach(callback,scope){return Object.forEach(this,callback,scope)},writable:true,enumerable:false,configurable:true},map:{value:function map(callback,scope){return Object.map(this,callback,scope)},writable:true,enumerable:false,configurable:true},map$:{value:function map$(callback,scope){return Object.map$(this,callback,scope)},writable:true,enumerable:false,configurable:true},reduce:{value:function reduce(callback,start){return Object.reduce(this,callback,start)},writable:true,enumerable:false,configurable:true},filter:{value:function filter(callback,scope){return Object.filter(this,callback,scope)},writable:true,enumerable:false,configurable:true},filter$:{value:function filter$(callback,scope){return Object.filter$(this,callback,scope)},writable:true,enumerable:false,configurable:true},clean:{value:function clean(callback,scope){return Object.clean(this,callback,scope)},writable:true,enumerable:false,configurable:true},clean$:{value:function clean$(callback,scope){return Object.clean$(this,callback,scope)},writable:true,enumerable:false,configurable:true},clone:{value:function clone(callback,scope){return Object.clone(this,callback,scope)},writable:true,enumerable:false,configurable:true},merge:{value:function merge(){return Object.merge.apply(undefined,[this].concat(Array.prototype.slice.call(arguments)))},writable:true,enumerable:false,configurable:true},merge$:{value:function merge$(){return Object.merge$.apply(undefined,[this].concat(Array.prototype.slice.call(arguments)))},writable:true,enumerable:false,configurable:true}})},writable:true,enumerable:false,configurable:true}});Object.defineProperties(String,{UUID:{value:function UUID(){return Array.range(0,35).map(function(i){switch(i){case 8:case 13:case 23:return"-";case 14:i=4;break;case 19:i=(Number.random(0,16).floor()&3)|8;break;default:i=Number.random(0,16).floor();break}return"0123456789ABCDEF"[i]}).join("")},writable:true,enumerable:false,configurable:true}});Object.defineProperties(String.prototype,{chars:{value:function chars(obj){for(var i=0,arr=[];i<this.length;i++){arr.push(this.charAt(i))}return arr},writable:true,enumerable:false,configurable:true},count:{value:function count(substr,mod){return this.match(RegExp(substr,mod||"gi")).length},writable:true,enumerable:false,configurable:true},insert:{value:function insert(substr,pos){return this.substr(0,pos||0)+substr+this.substr(pos||0)},writable:true,enumerable:false,configurable:true},remove:{value:function remove(substr){return this.replace(substr,"")},writable:true,enumerable:false,configurable:true},reverse:{value:function reverse(){return this.chars().reverse().join("")},writable:true,enumerable:false,configurable:true},ucfirst:{value:function ucfirst(){return this.charAt(0).toUpperCase()+this.substr(1)},writable:true,enumerable:false,configurable:true},swapcase:{value:function swapcase(){return this.chars().map(function(a){return/[a-z]/.test(a)?a.toUpperCase():a.toLowerCase()}).join("")},writable:true,enumerable:false,configurable:true},rpad:{value:function rpad(len,chars){len=Number(len);if(len<this.length){return this.valueOf()}for(var str=this;str.length<len;str+=(chars||" ")){}return str.substr(0,len)},writable:true,enumerable:false,configurable:true},lpad:{value:function lpad(len,chars){len=Number(len);if(len<this.length){return this.valueOf()}chars=(chars||" ").reverse();for(var str=this;str.length<len;str=(chars+str)){}return str.substr(str.length-len)},writable:true,enumerable:false,configurable:true},pad:{value:function pad(len,chars){return this[len>0?"rpad":"lpad"](Math.abs(len),chars)},writable:true,enumerable:false,configurable:true},soundex:{value:function soundex(){return this.substr(0,1).toUpperCase()+this.toUpperCase().substr(1).remove(/[^A-Z]/gi).trim().replace(/DG/g,"G").replace(/GH/g,"H").replace(/GN|KN/g,"N").replace(/PH/g,"F").replace(/MP([STZ])/g,"M$1").replace(/^PS/g,"S").replace(/^PF/g,"F").replace(/MB/g,"M").replace(/TCH/g,"CH").replace(/[AEIOUHWY]/g,"0").replace(/[BFPV]/g,"1").replace(/[CGJKQSXZ]/g,"2").replace(/[DT]/g,"3").replace(/[L]/g,"4").replace(/[MN]/g,"5").replace(/[R]/g,"6").replace(/(\w)\1+/g,"$1").slice(0,3).rpad(3,"0")},writable:true,enumerable:false,configurable:true},distance:{value:function distance(c){var s,l=(s=this.split("")).length,t=(c=c.split("")).length,i,j,m,n;if(!(l||t)){return Math.max(l,t)}for(var a=[],i=l+1;i;a[--i]=[i]){}for(i=t+1;a[0][--i]=i;){}for(i=-1,m=s.length;++i<m;){for(j=-1,n=c.length;++j<n;){a[(i*=1)+1][(j*=1)+1]=Math.min(a[i][j+1]+1,a[i+1][j]+1,a[i][j]+(s[i]!=c[j]))}}return a[l][t]},writable:true,enumerable:false,configurable:true},soundex:{value:function soundex(){return this.substr(0,1).toUpperCase()+this.toUpperCase().substr(1).remove(/[^A-Z]/gi).trim().replace(/DG/g,"G").replace(/GH/g,"H").replace(/GN|KN/g,"N").replace(/PH/g,"F").replace(/MP([STZ])/g,"M$1").replace(/^PS/g,"S").replace(/^PF/g,"F").replace(/MB/g,"M").replace(/TCH/g,"CH").replace(/[AEIOUHWY]/g,"0").replace(/[BFPV]/g,"1").replace(/[CGJKQSXZ]/g,"2").replace(/[DT]/g,"3").replace(/[L]/g,"4").replace(/[MN]/g,"5").replace(/[R]/g,"6").replace(/(\w)\1+/g,"$1").rpad(3,"0")},writable:true,enumerable:false,configurable:true},sprintf:{value:function sprintf(c){var vals=arguments,regex=/%%|%(?:(\d+)[\$#])?([+-])?('.|0| )?(\d*)(?:\.(\d+))?([bcdfosuxX])/g;var index=0;return this.replace(regex,function(substr,flags,align,padding,width,precision,type){if(substr=="%%"){return"%"}flags=flags||"",align=align||"",padding=(padding||"").slice(-1)||" ",width=width||"",precision=precision||"";val=vals[+flags?flags-1:index];index++;if(type.match(/[duobxXf]{1}/)){val=Number(val)}else{val=String(val)}switch(type){case"d":case"u":return val.dec(align+width,padding);case"o":return val.oct(align+width,padding);case"b":return val.bin(align+width,padding);case"x":return val.hexl(align+width,padding);case"X":return val.hex(align+width,padding);case"s":return val.pad(align+width,padding);case"c":return String.fromCharCode(val).pad(align+width,padding);case"f":if(precision){val=val.toFixed(precision)}else{if(width){val=val.toExponential(width)}else{val=val.toExponential()}}align=align=="-"?"+":"-";return val.toString().pad(align+width,padding)}})},writable:true,enumerable:false,configurable:true}});