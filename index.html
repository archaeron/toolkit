<html>
    <head>
        <meta http-equiv="Pragma" content="no-cache">
        
        <link href="http://fonts.googleapis.com/css?family=Droid+Sans:400,700" rel="stylesheet" type="text/css">
        
        <link href="css/button.css" rel="stylesheet" type="text/css">
        <link href="css/grid.css" rel="stylesheet" type="text/css">
        <link href="css/style.css" rel="stylesheet" type="text/css">
        <link href="css/style.css" rel="stylesheet" type="text/css">
        
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
        <script type="text/javascript" src="js/jst.min.js"></script>
        <script type="text/javascript" src="js/util.js"></script>
    </head>
    <body>
        <div id="banner">
            <div class="container-12">
                <div class="grid-6 alpha">
                    <h1><img src="img/logo-64.png">JSToolkit</h1>
                </div>
                <ul id="nav" class="grid-6">
                    <li><a href="index.html">Home</a></li>
                    <li><a id="nav-docs" href="#">Documentation</a></li>
                    <li><a href="https://github.com/ollym/toolkit">Source Code</a></li>
                </ul>
            </div>
            <div class="clear"></div>
        </div>
        <div id="header">
            <div class="container-12">
                <div class="grid-4 omega">
                    <h4>ECMA5 Compliant!</h4>
                    <p><img src="img/home/ecma5.png" alt="api">
                        Built on the latest ECMA5 JavaScript specifications while filling in the gaps in legacy browsers.</p>
                </div>
                <div class="grid-4 omega">
                    <h4>Clean API!</h4>
                    <p><img src="img/home/api.png" alt="api">
                        Over <strong>86</strong> highly optimized native extension methods added to aid data processing.</p>
                </div>
                <div class="grid-4 omega">
                    <h4>Useful Documentation!</h4>
                    <p><img src="img/home/docs.png" alt="docs">
                        Over <strong>86</strong> highly optimized native extension methods added to aid data processing.</p>
                </div>
                <div class="clear" style="height:20px"></div>
                <div class="grid-4 omega">
                    <h4>100% Test Coverage!</h4>
                    <p><img src="img/home/tick.png" alt="tick">
                        Every release is tested using our unit-test framework that covers every method in the framework.</p>
                </div>
                <div class="grid-4 omega">
                    <h4>Node.JS Support!</h4>
                    <p><img src="img/home/node.png" alt="tick">
                        JSToolkit is fully tested on the Node.JS platform and is available and listed on NPM</p>
                </div>
                <div class="grid-4 omega">
                    <h4>Free &amp; Open-Source!</h4>
                    <p><img src="img/home/os.png" alt="tick">
                        Free to use, sell, distribute etc. Licensed under the very liberal MIT license.</p>
                </div>
            </div>
        </div>
        <div id="content">
            <div id="loading"><h4>Loading. Please wait.</h4></div>
            <div class="container-12" style="display:none;opacity:0" id="main">
                <div class="grid-6 alpha">
                    <h4>JSToolkit <span id="latest-tag"> </span><span class="release-state">STABLE</span></h4>
                    <p id="latest-committer" class="tagline"></p>
                    <h5>Changelog</h5>
                    <ul id="latest-changelog"></ul>
                    <a id="latest-download" title="" target="_blank" class="btn green">Download <span id="latest-size"></span></a>
                    <a id="latest-docs" title="" class="btn blue">Documentation</a>
                    <a id="latest-source" title="" target="_blank" class="btn orange">Source Tree</a>
                    <script type="text/javascript">
                    $.getJSONP('https://api.github.com/repos/ollym/toolkit/git/refs/tags', function(tags) {
                        
                        var latest = tags.sortBy('ref', function(a,b) {
                            a = a.remove('refs/tags/v').split('.').map(Number), b = b.remove('refs/tags/v').split('.').map(Number);
                            return a[0] > b[0] || a[1] > b[1] || a[2] > b[2];
                        }).last().ref.remove('refs/tags/');
                        
                        $('#latest-tag').removeAttr('data-loading').text(latest);
                        $.getJSONP(tags.last().object.url, function(tag) {
                            $('#latest-committer').removeAttr('data-loading').html(
                                'Released %ss ago by <a href="mailto:%s">%s</a>'.sprintf(
                                    tag.committer.date, tag.committer.email, tag.committer.name));
                        });
                        $.getJSONP('https://api.github.com/repos/ollym/toolkit/git/trees/' + tags.last().object.sha, function(tree) {
                            
                            $('#latest-download').attr('href', 'https://raw.github.com/ollym/toolkit/%s/dist/jst.min.js'
                                .sprintf(tree.sha));
                                
                            $('#latest-source').attr('href', 'https://github.com/ollym/toolkit/tree/%s'
                                .sprintf(tree.sha));
                            
                            // Get the distribution size and url
                            $.getJSONP(tree.tree.each(function(file) {
                                if (file.path === 'dist') return file.url;
                            }), function(dist) {
                                
                                var min = dist.tree.each(function(file) {
                                   if (file.path == 'jst.min.js') return file; 
                                });
                                
                                var max = dist.tree.each(function(file) {
                                   if (file.path == 'jst.js') return file; 
                                });
                                
                                $('#latest-size').text(min.size.abbr(1,true) + 'b');
                                $('#latest-docs').attr('href', 'docs.html?sha=%s'.sprintf(max.sha));
                                $('#nav-docs').attr('href', 'docs.html?sha=%s'.sprintf(max.sha));
                            });
                            
                            // Get the changelog
                            $.getJSONP(tree.tree.each(function(file) {
                                if (file.path === 'HISTORY.md') return file.url;
                            }), function(blob) {
                                
                                
                                var hist = blob.content.atob().split('=================='), 
                                    idx = hist.each(function(ver, i) {
                                        var match = ver.match(/(\d*\.\d*\.\d*)\s*\/\s*\d*-\d*-\d*\s*$/);
                                        if (match && match[1] == latest.substr(1)) return i+1;
                                    }),
                                    changelog = hist[idx].split('\n').map(function(line) {
                                        return line.trim().remove(/^\*\s*/);
                                    }).clean().slice(0, -1);
                                
                                $('#latest-changelog').removeAttr('data-loading');
                                changelog.forEach(function(change) {
                                    $('#latest-changelog').append('<li>%s</li>'.sprintf(change));
                                });
                           });
                        });
                    }); 
                    </script>
                </div>
                <div class="grid-6 omega sidebar">
                    <h4>Recent Commits</h4>
                    <ul id="latest-commits" data-loading></ul>
                    <script type="text/javascript">
                    $.getJSONP('https://api.github.com/repos/ollym/toolkit/git/refs/heads/master', function(parent) {
                        (function next(i, parent) { if (i === 0) { $('#latest-commits').removeAttr('data-loading'); return; }
                            $.getJSONP('https://api.github.com/repos/ollym/toolkit/git/commits/' + parent.sha, function(commit) {
                                
                                var tmpl = '<li><a class="title" target="_blank" href="%s">%s</a><p class="tagline">%s</p></li>',
                                    li = $(tmpl.sprintf('https://github.com/ollym/toolkit/commit/' + commit.sha, commit.message,
                                        'by <a href="mailto:%s">%s</a> %dms ago'.sprintf(commit.author.email, commit.author.name,
                                            commit.author.date)));
                                
                                if (i == 5) li.addClass('first');
                                else if (i === 1) li.addClass('last');            
                                
                                $('#latest-commits').append(li);
                                
                                next(--i, commit.parents[0]);
                            });
                        })(5, parent.object);
                    });
                    </script>
                </div>
            </div>
        </div>
        <div id="footer">
            Copyright &copy; 2011 <a href="mailto:oliver.morgan@kohark.com">Oliver Morgan</a><br>
                JSToolkit is licensed under the <a href="http://en.wikipedia.org/wiki/MIT_License">MIT license</a>.
        </div>
    </body>
</html>